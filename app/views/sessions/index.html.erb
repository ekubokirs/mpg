<nav class="top-bar">
	<ul class="title-area">
		<li class="name">
			<h1></h1>
		</li>
		<li class="toggle-topbar menu-icon">
			<a href="#">
				<span>Menu</span>
			</a>
		</li>
	</ul>
	<section class="top-bar-section">
		<ul class="right">
			<li class="divider"></li>
			<li><%= link_to "Add New Tank", new_tank_url %></li>
			<li class="divider"></li>
			<li><%= link_to "Add New Car", new_car_url %></li>
			<li class="divider"></li>
			<li><%= link_to "See All Cars", cars_url %></li>
			<li class="divider"></li>
			<li><%= link_to "Log Out", logout_url %></li>				
		</ul>
	</section>
</nav>
<div class="mp_back">
	<div class="row">
		<ul class="side-nav small-1 columns mp_side">
			<% @cars.each do |c| %>
				<li class="car" id="<%= c.name %>" car-id="<%= c.id %>"><a href="#"><%= c.name %></a></li>
			<% end %>
		</ul>
		<div id="graph"></div>
		<script type="text/javascript" id="sidebar">
			jQuery(document).ready(function ($) {
    // Write AJAX GET request for each line class on-click
    $("body").on("click", '.car', function(){
      // Empty #chart div first
      $("#graph").empty();
      // console.log($(this).attr("car-id"));
      // console.log(color);
      // Get data
      $.ajax({
        method: "GET",
        url: "/car/" + $(this).attr("car-id") + "/stats",
        contentType: 'application/json',
        dataType: 'json',
        success: function(data) {
          data = data;
          // d3Chart method fills chart
          d3Chart(data);
        }
      }); // End AJAX call
    }); // End on-click
  });
		</script>
		<script type="text/javascript" id="graph">
			var data = [{year: 2006, mpg: 54},
			            {year: 2007, mpg: 43},
			            {year: 2008, mpg: 41},
			            {year: 2009, mpg: 44},
			            {year: 2010, mpg: 35}];

			var barWidth = 40;
			var width = (barWidth + 10) * data.length;
			var height = 200;

			var x = d3.scale.linear().domain([0, data.length]).range([0, width]);
			var y = d3.scale.linear().domain([0, d3.max(data, function(datum) { return datum.mpg; })]).
			  rangeRound([0, height]);

			// add the canvas to the DOM
			var graph = d3.select("#graph").
			  append("svg:svg").
			  attr("width", width).
			  attr("height", height);

			graph.selectAll("rect").
			  data(data).
			  enter().
			  append("svg:rect").
			  attr("x", function(datum, index) { return x(index); }).
			  attr("y", function(datum) { return height - y(datum.mpg); }).
			  attr("height", function(datum) { return y(datum.mpg); }).
			  attr("width", barWidth).
			  attr("fill", "#225a22");

			 graph.selectAll("text").
			  data(data).
			  enter().
			  append("svg:text").
			  attr("x", function(datum, index) { return x(index) + barWidth; }).
			  attr("y", function(datum) { return height - y(datum.mpg); }).
			  attr("dx", -barWidth/2).
			  attr("dy", "1.2em").
			  attr("text-anchor", "middle").
			  text(function(datum) { return datum.mpg;}).
			  attr("fill", "white");

			graph.selectAll("text.yAxis").
			  data(data).
			  enter().append("svg:text").
			  attr("x", function(datum, index) { return x(index) + barWidth; }).
			  attr("y", height).
			  attr("dx", -barWidth/2).
			  attr("text-anchor", "middle").
			  attr("style", "font-size: 12; font-family: Helvetica, sans-serif").
			  text(function(datum) { return datum.year;}).
			  attr("transform", "translate(0, 18)").
			  attr("class", "yAxis");
		</script>
	</div>
	<div class="row">
		<table>	
			<thead>
				<tr>
					<td>Amount</td>
					<td>Miles</td>
					<td>MPG</td>
					<td>Price</td>
					<td>Date</td>
				</tr>
			</thead>
			<tbody>
				<% @tanks.each do |t| %>
					<tr>
						<td><%= t.amount %></td>
						<td><%= t.current_miles %></td>
						<td><%= t.mpg %></td>
						<td><%= t.price %></td>
						<td><%= t.updated_at %>
					</tr>
				<% end %>
			</tbody>
		</table>
	</div>
</div>